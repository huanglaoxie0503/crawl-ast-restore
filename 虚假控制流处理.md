虚假控制流的一些介绍和一种处理思路

## 什么是虚假控制流

虚假控制流是一种对抗静态分析的手段，主要就是为了让我们难以直接通过纯静态的方式将平坦化之后的控制流直接还原得到正常的代码。

主要方法就是通过一些**不透明谓词**使得在代码产生分支处理的地方走向死循环或者一些陷阱分支。

不透明谓词指的就是一个变量在某处的值在代码执行之前就是确定的，但是对于静态分析而言，不执行就无法明确这个变量的值。就比如，在浏览器里面window、navigator等这些变量是恒为真的，但是在混淆后的代码中，我只需要反复赋值，让变量的最终指向难以通过直接分析得到，就让我们在处理虚假控制流的时候掉入虚假分支陷阱。

## 一种处理思路

处理控制流的核心要点就是，明确每一个节点的下一步执行是指向了哪里，只要明确了这一点，那么所有的控制流都是纸老虎。

所以这就引申出我们的一种处理方法，纯静态不行，那么就结合动态的处理，既然核心要点是知道一个节点的下一步执行指向哪里，那么我就在真实环境下执行一遍，并且保存每一个节点的下一个节点是指向的哪里，根据真实环境下的执行流去还原控制流。

## 该处理思路的缺陷

1. 执行的路径实际上是组成了一个有向图，我们需要在图上处理得到各种高级的结构，处理起来还是略微有点烦的，可以试试例如networkx这样的图处理库用内置的各种子图同构算法来匹配规约处理。
2. 生成的路径完全依赖于获取真实执行流时的环境，当前环境下没有经过的路径是不会在我们获取的执行路径中反映出来的。